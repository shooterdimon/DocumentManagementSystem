***Підсистеми пошуку (Повнотекстовий пошук)***
==============================================

Повнотекстовий пошук (англ. Full text searching, фр. Recherche en texte integral) - автоматизований пошук документів, при якому пошук ведеться не по іменах документів, а по їх вмісту, всьому або істотної частини.
Загалом, існує компроміс між "точністю" і "відкликанням". Висока точність означає, що представлено менше нерелевантних результатів (немає помилкових спрацьовувань), в той час як високий відгук означає, що менше релевантних результатів відсутній (немає помилкових негативів). Використання оператора LIKE дає 100% точність без поступок для відкликання. Повнотекстовий пошук дає велику гнучкість для налаштування точності для кращого відкликання.

У більшості повнотекстових пошукових реалізацій використовується "інвертований індекс". Це індекс, де ключі є окремими термінами, а пов'язані значення - це групи записів, які містять цей термін. Повнотекстовий пошук оптимізований для обчислення перетинів, об'єднань і т.д. Цих наборів записів і зазвичай надає алгоритм ранжирування для кількісної оцінки того, наскільки сильно дана запис відповідає ключовим словами пошуку.
Оператор SQL LIKE може бути вкрай неефективним. Якщо застосувати його до колонку без індексації, для пошуку збігів буде використовуватися повне сканування (точно так само як будь-який запит в неіндексованих поле). Якщо індекс індексується, зіставлення може виконуватися за допомогою індексних ключів, але з набагато меншою ефективністю, ніж більшість запитів індексу. У гіршому випадку шаблон LIKE матиме основні шаблони, які вимагають, щоб кожен індексний ключ був перевірений. Навпаки, багато інформаційно-пошукові системи можуть підтримувати підтримку провідних символів узагальнення шляхом попередньої компіляції суфіксів в обраних полях.

***Інші функції, характерні для повнотекстового пошуку:***
----------------------------------------------------------
1. лексичний аналіз або токенізація; блок неструктурованого тексту в окремі слова, фрази і спеціальні маркери
2. морфологічний аналіз, або згортання змін даного слова в один індексний термін; наприклад, лікування "мишей" і "миша" або "електрифікація" і "електричний" як одне і те ж слово
3. рейтинг - вимір схожість збігається записи з рядок запиту
повнотекстовий індекс

Перші версії програм повнотекстового пошуку припускали сканування всього вмісту всіх документів в пошуку заданого слова або фрази. При використанні такої технології пошук займав дуже багато часу (в залежності від розміру бази), а в інтернеті був би нездійсненний. Сучасні алгоритми заздалегідь формують для пошуку так званий повнотекстовий індекс - словник, в якому перераховані всі слова і вказано, в яких місцях вони зустрічаються. При наявності такого індексу досить здійснити пошук потрібних слів в ньому і тоді відразу ж буде отримано список документів, в яких вони зустрічаються.

У повнотекстовий індекс включається один або кілька символьних стовпців таблиці. Ці стовпці можуть містити будь-який з наступних типів даних: char, varchar, nchar, nvarchar, text, ntext, image, xml або varbinary (max) і FILESTREAM. Кожний повнотекстовий індекс індексує один або декілька стовпців таблиці, а кожній колонці може відповідати певна мова.

***Порівняння предиката LIKE і запитів повнотекстового пошуку***
----------------------------------------------------------------

На відміну від повнотекстового пошуку предикат LIKE Transact-SQL працює тільки з комбінаціями символів. Крім того, предикат LIKE можна використовувати в запитах до форматованим двійковим даними. Більш того, запит з предикатом LIKE до великої кількості неструктурованих текстових даних виконується набагато повільніше, ніж еквівалентний повнотекстовий запит до тих самих даних. Виконання запиту LIKE до кільком мільйонам рядків текстових даних може зайняти кілька хвилин, в той час як повнотекстовий запит до тих же даних займає всього кілька секунд або навіть менше, залежно від кількості повертаються рядків.

***Обробка повнотекстових запитів***
------------------------------------

Оброблювач запитів передає для обробки повнотекстові частини запиту засобу повнотекстового пошуку. Засіб повнотекстового пошуку виконує розбиття за словами і при необхідності розширення тезауруса, морфологічний пошук і обробку стоп-слів (пропускаються слів). Потім повнотекстові частини запиту подаються у формі операторів SQL, в основному як потокові функції, які повертають табличні значення. Під час виконання запиту ці потокові функції для отримання правильних результатів звертаються до інвертований індекс. Результати повертаються клієнтові в цій точці, або перед поверненням клієнтові вони піддаються додатковій обробці.

***Структура повнотекстового індексу***
---------------------------------------

Щоб зрозуміти, як працює засіб повнотекстового пошуку, необхідно розібратися в структурі повнотекстового індексу. Багато СУБД підтримують методи повнотекстового пошуку (Fulltext search), які дозволяють дуже швидко знаходити потрібну інформацію у великих обсягах тексту. На відміну від оператора LIKE, такий тип пошуку передбачає створення відповідного повнотекстового індексу, який представляє собою своєрідний словник згадок слів в полях. Під словом розуміється сукупність з не менш 3-х не пробільних символів (але це може бути змінено). Залежно від даних словника може бути обчислена релевантність – порівняльна міра відповідності запиту знайденої інформації. У статті розповідається як працювати з повнотекстовим пошуком на прикладі БД MySQL, а так само наведу приклади «нестандартного» використання даного механізму. В MySQL можливості повнотекстового пошуку (лише для MyISAM-таблиць) підтримуються починаючи з версії 3.23.23. В наступних версіях механізм зазнав істотні доопрацювання і розширення, в тозі перетворившись на потужний засіб для створення пошукових механізмів веб-додатків. Головна особливість – швидкий пошук слів в дуже великих обсягах текстової інформації. 

***Індекс FULLTEXT***
---------------------

Отже, щоб працювати з повнотекстовим пошуком, спочатку нам потрібно створити відповідний індекс. Він називається FULLTEXT, і може бути накладено на поля CHAR, VARCHAR і TEXT. Причому, як і у випадку зі звичайним індексом – якщо відбувається пошук по 2-м полям, то потрібен об'єднаний індекс 2-х полів, використовуйте пошук по одному полю – потрібен індекс тільки цього поля. 
Наприклад:

CREATE TABLE `articles` (
`id` int(10) unsigned NOT NULL auto_increment,
`title` varchar(200) default NULL,
`body` text, PRIMARY KEY (`id`), 
FULLTEXT KEY `ft1` (`title`,`body`), 
FULLTEXT KEY `ft2` (`body`) 
) ENGINE=MyISAM DEFAULT CHARSET=utf8;

У цьому прикладі створюється таблиця з 2-ма повнотекстовими індексами: ft1 і ft2, які можна використовувати для пошуку в полях title і body, або тільки в body.  Тільки в поле title шукати не вийде.

***Конструкція MATCH-AGAINST***
-------------------------------

Власне для самого повнотекстового пошуку в MySQL використовується конструкція MATCH (filelds) ... AGAINST (words).  Вона може працювати в різних режимах, які досить сильно між собою відрізняються.  Для всіх діє наступне правило: дана конструкція повертає умовну релевантність, але спосіб обчислення якої може бути різним у залежності від режиму.  Ще варто додати що у всіх режимах пошук завжди чутливі до регістру.



